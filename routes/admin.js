const _0x10a772 = _0x5bc0; (function (_0x56981e, _0x4f0607) { const _0x31de7b = _0x5bc0, _0x9a1674 = _0x56981e(); while (!![]) { try { const _0x507b86 = -parseInt(_0x31de7b(0xc6)) / 0x1 * (-parseInt(_0x31de7b(0xf9)) / 0x2) + parseInt(_0x31de7b(0xda)) / 0x3 + parseInt(_0x31de7b(0xde)) / 0x4 * (-parseInt(_0x31de7b(0xed)) / 0x5) + -parseInt(_0x31de7b(0xe7)) / 0x6 + parseInt(_0x31de7b(0xd8)) / 0x7 + -parseInt(_0x31de7b(0xe6)) / 0x8 + -parseInt(_0x31de7b(0xb8)) / 0x9 * (-parseInt(_0x31de7b(0xe9)) / 0xa); if (_0x507b86 === _0x4f0607) break; else _0x9a1674['push'](_0x9a1674['shift']()); } catch (_0x4b8cf9) { _0x9a1674['push'](_0x9a1674['shift']()); } } }(_0x41b2, 0x64730)); const router = require(_0x10a772(0xbf))[_0x10a772(0xc4)](), con = require('../config/config'), { sign } = require('jsonwebtoken'), bcrypt = require(_0x10a772(0xd9)), randomstring = require(_0x10a772(0xe5)), moment = require(_0x10a772(0xf0)), { isvalid, isvaliddownload } = require(_0x10a772(0xcd)), mysqlDump = require(_0x10a772(0xca)), Importer = require(_0x10a772(0xcc)), path = require(_0x10a772(0xc0)), fs = require('fs'); router[_0x10a772(0xd2)](_0x10a772(0xbb), async (_0x51f0af, _0x5951a3) => { const _0x402b7b = _0x10a772; if (!_0x51f0af[_0x402b7b(0xf1)]['email'] || !_0x51f0af[_0x402b7b(0xf1)][_0x402b7b(0xd6)]) { _0x5951a3[_0x402b7b(0xf7)]({ 'msg': 'All\x20fields\x20are\x20required.' }); return; } try { con['query']('SELECT\x20*\x20FROM\x20admin\x20WHERE\x20email\x20=\x20\x27' + _0x51f0af[_0x402b7b(0xf1)][_0x402b7b(0xf3)]['toLowerCase']() + '\x27\x20', (_0x54d510, _0x58bbec) => { const _0x5e330c = _0x402b7b; if (_0x54d510) { _0x5951a3[_0x5e330c(0xf7)]({ 'success': ![], 'msg': _0x5e330c(0xe0), 'err': _0x54d510 }); return; } else _0x58bbec[_0x5e330c(0xc3)] > 0x0 ? bcrypt[_0x5e330c(0xcb)](_0x51f0af[_0x5e330c(0xf1)][_0x5e330c(0xd6)], _0x58bbec[0x0][_0x5e330c(0xd6)])[_0x5e330c(0xc7)](_0x1d1b49 => { const _0x3026a1 = _0x5e330c; if (!_0x1d1b49) return _0x5951a3[_0x3026a1(0xf7)]({ 'success': ![], 'msg': 'Wrong\x20credentials' }); const _0x9d3acb = sign({ 'uid': _0x58bbec[0x0][_0x3026a1(0xe4)], 'email': _0x58bbec[0x0][_0x3026a1(0xf3)], 'role': _0x3026a1(0xdf), 'password': _0x58bbec[0x0][_0x3026a1(0xd6)] }, process[_0x3026a1(0xf5)]['JWTKEY'], {}); _0x5951a3[_0x3026a1(0xf7)]({ 'success': !![], 'msg': _0x3026a1(0xf8), 'token': _0x9d3acb }); return; })[_0x5e330c(0xb5)](_0x43cc10 => { const _0x367294 = _0x5e330c; _0x5951a3[_0x367294(0xf7)]({ 'success': ![], 'msg': _0x367294(0xeb) }); }) : _0x5951a3[_0x5e330c(0xf7)]({ 'success': ![], 'msg': _0x5e330c(0xc9) }); }); } catch (_0x193055) { _0x5951a3[_0x402b7b(0xf7)]({ 'err': _0x193055, 'msg': _0x402b7b(0xeb) }); } }), router[_0x10a772(0xc1)](_0x10a772(0xe3), isvalid, async (_0x1ade74, _0x568fe9) => { const _0x102ff4 = _0x10a772; try { var _0x3fed1d = _0x102ff4(0xfa); con[_0x102ff4(0xbc)](_0x3fed1d, (_0x48b762, _0x3a0c18) => { const _0x484913 = _0x102ff4; if (_0x48b762) return _0x568fe9['json']({ 'msg': _0x484913(0xb9), 'err': _0x48b762 }); else _0x568fe9[_0x484913(0xf7)]({ 'success': !![], 'data': _0x3a0c18 }); }); } catch (_0xb8c711) { _0x568fe9['json']({ 'msg': _0x102ff4(0xeb), 'err': _0xb8c711 }), console[_0x102ff4(0xf4)](_0xb8c711); } }), router[_0x10a772(0xc1)](_0x10a772(0xbe), isvalid, (_0x2eacc5, _0x84c751) => { const _0x559c51 = _0x10a772; _0x84c751[_0x559c51(0xf7)]({ 'data': _0x2eacc5[_0x559c51(0xf6)] }); }), router['post'](_0x10a772(0xe2), isvalid, (_0x48a584, _0x239f32) => { const _0x4072cc = _0x10a772; console['log'](_0x48a584['body']), con[_0x4072cc(0xbc)](_0x4072cc(0xf2), (_0x2b17db, _0xe3240c) => { const _0x5ad2d6 = _0x4072cc; if (_0x2b17db) { _0x239f32[_0x5ad2d6(0xf7)]({ 'success': ![], 'msg': _0x5ad2d6(0xe0), 'err': _0x2b17db }); return; } else _0xe3240c[_0x5ad2d6(0xc3)] > 0x0 ? bcrypt['compare'](_0x48a584[_0x5ad2d6(0xf1)][_0x5ad2d6(0xd6)], _0xe3240c[0x0][_0x5ad2d6(0xd6)])[_0x5ad2d6(0xc7)](_0x19d6f7 => { const _0x1591aa = _0x5ad2d6; if (!_0x19d6f7) return _0x239f32['json']({ 'success': ![], 'msg': _0x1591aa(0xc2) }); if (_0x48a584[_0x1591aa(0xf1)][_0x1591aa(0xee)]) { if (_0x48a584[_0x1591aa(0xf1)]['new_password'][_0x1591aa(0xc3)] < 0x8) return _0x239f32[_0x1591aa(0xf7)]({ 'msg': 'Please\x20give\x20at\x20least\x208\x20charector\x20length\x20in\x20the\x20new\x20password.' }); bcrypt['hash'](_0x48a584[_0x1591aa(0xf1)]['new_password'], 0xa)[_0x1591aa(0xc7)](_0x47ec13 => { const _0x5e4db2 = _0x1591aa; con[_0x5e4db2(0xbc)](_0x5e4db2(0xd4) + _0x48a584[_0x5e4db2(0xf1)][_0x5e4db2(0xf3)] + '\x27,\x20password\x20=\x20\x27' + _0x47ec13 + '\x27\x20', (_0x2ee8b3, _0x4d6141) => { const _0x31bce0 = _0x5e4db2; return _0x2ee8b3 ? _0x239f32['json']({ 'msg': 'DB\x20query\x20error', 'err': _0x2ee8b3 }) : _0x239f32[_0x31bce0(0xf7)]({ 'msg': _0x31bce0(0xb6), 'logout': !![] }); }); }); } else con[_0x1591aa(0xbc)](_0x1591aa(0xd4) + _0x48a584[_0x1591aa(0xf1)]['email'] + '\x27\x20', (_0x4e402b, _0x2aa6ce) => { const _0x22a881 = _0x1591aa; return _0x2b17db ? _0x239f32[_0x22a881(0xf7)]({ 'msg': _0x22a881(0xb9), 'err': _0x4e402b }) : _0x239f32[_0x22a881(0xf7)]({ 'msg': _0x22a881(0xb6), 'logout': !![] }); }); return; })[_0x5ad2d6(0xb5)](_0x53f154 => { const _0xc1b5f5 = _0x5ad2d6; _0x239f32[_0xc1b5f5(0xf7)]({ 'success': ![], 'msg': 'Server\x20error' }); }) : _0x239f32[_0x5ad2d6(0xf7)]({ 'success': ![], 'msg': _0x5ad2d6(0xc9) }); }); }), router[_0x10a772(0xc1)](_0x10a772(0xdd), isvalid, async (_0x582642, _0x4a80a5) => { const _0x2734ce = _0x10a772, _0x2740b3 = moment()['format']('DD-MMMM-YYYY\x20hh:mm'); mysqlDump({ 'connection': { 'host': process['env'][_0x2734ce(0xdb)], 'user': process[_0x2734ce(0xf5)][_0x2734ce(0xc8)], 'password': process[_0x2734ce(0xf5)][_0x2734ce(0xbd)], 'database': process[_0x2734ce(0xf5)]['DATABASE'] }, 'dumpToFile': __dirname + '/../backup/' + _0x2740b3 + _0x2734ce(0xc5) }), console['log']('file-saved'), _0x4a80a5[_0x2734ce(0xf7)]({ 'msg': 'Backup\x20genrated' }); }), router[_0x10a772(0xd2)]('/delete_backup_file', isvalid, async (_0x18f3ca, _0xbcfb66) => { const _0x22ff66 = _0x10a772; try { var _0xb75616 = __dirname + _0x22ff66(0xb7) + _0x18f3ca[_0x22ff66(0xf1)][_0x22ff66(0xea)]; fs[_0x22ff66(0xec)](_0xb75616), _0xbcfb66['json']({ 'success': !![], 'msg': _0x22ff66(0xba) }); } catch (_0x5ad1e9) { console['log'](_0x5ad1e9), _0xbcfb66[_0x22ff66(0xf7)]({ 'success': ![], 'err': _0x5ad1e9, 'msg': 'Server\x20error' }); } }), router[_0x10a772(0xc1)](_0x10a772(0xd3), isvalid, async (_0x50905c, _0x5cd95f) => { const _0x3602c0 = _0x10a772; try { const _0x44e01a = fs[_0x3602c0(0xef)](__dirname + _0x3602c0(0xe8)), _0x516178 = _0x44e01a['map'](_0x3f9f23 => { const _0x12d5e3 = _0x3602c0, _0xe4f31c = fs[_0x12d5e3(0xcf)](__dirname + _0x12d5e3(0xb7) + _0x3f9f23)[_0x12d5e3(0xce)][_0x12d5e3(0xd0)](); return { 'date': moment(_0xe4f31c)[_0x12d5e3(0xd1)](_0x12d5e3(0xdc)), 'name': _0x3f9f23 }; }); _0x5cd95f['json']({ 'data': _0x516178 }); } catch (_0x51ed84) { console[_0x3602c0(0xf4)](_0x51ed84), _0x5cd95f['json']({ 'success': ![], 'err': _0x51ed84, 'msg': _0x3602c0(0xeb) }); } }), router[_0x10a772(0xc1)](_0x10a772(0xd7), isvaliddownload, async (_0x1a4b7b, _0x180f59) => { const _0x2f71fb = _0x10a772; try { const _0x30753a = _0x1a4b7b[_0x2f71fb(0xbc)]['file_name']; _0x180f59['download'](__dirname + _0x2f71fb(0xb7) + _0x30753a, _0x17d1f8 => { const _0x5f3036 = _0x2f71fb; if (_0x17d1f8) return [_0x180f59[_0x5f3036(0xf7)]({ 'msg': _0x5f3036(0xd5), 'name': _0x30753a, 'err': _0x17d1f8 }), console[_0x5f3036(0xf4)](_0x17d1f8)]; else console[_0x5f3036(0xf4)]('file\x20saved'); }); } catch (_0x2f1aec) { } }), module[_0x10a772(0xe1)] = router; function _0x5bc0(_0x2e95cb, _0x1cf94d) { const _0x41b2fe = _0x41b2(); return _0x5bc0 = function (_0x5bc05b, _0x574e12) { _0x5bc05b = _0x5bc05b - 0xb5; let _0x3d5d18 = _0x41b2fe[_0x5bc05b]; return _0x3d5d18; }, _0x5bc0(_0x2e95cb, _0x1cf94d); } function _0x41b2() { const _0x375853 = ['Router', '_grace.sql', '187milopr', 'then', 'DBUSER', 'Invalid\x20Credentials', 'mysqldump', 'compare', 'mysql-import', '../middlewares/user', 'mtime', 'statSync', 'getTime', 'format', 'post', '/backup_files', 'UPDATE\x20admin\x20SET\x20email=\x20\x27', 'Something\x20went\x20wront', 'password', '/download_backup', '1108492FkyXPG', 'bcrypt', '410550djxQbq', 'DBHOST', 'DD-MMMM-YYYY\x20hh:mm', '/export_db', '53196wSMpPB', 'admin', 'Database\x20query\x20error', 'exports', '/change_pw', '/get_all_user', 'uid', 'randomstring', '948224tpJmFk', '4665924wNpxDQ', '/../backup', '432980HotMMx', 'file_name', 'Server\x20error', 'unlinkSync', '185ClJjjd', 'new_password', 'readdirSync', 'moment', 'body', 'SELECT\x20*\x20FROM\x20admin\x20WHERE\x20role\x20=\x20\x27admin\x27\x20', 'email', 'log', 'env', 'decode', 'json', 'Login\x20success', '6366QkomqD', 'SELECT\x20*\x20from\x20user', 'catch', 'Admin\x20credentials\x20has\x20been\x20updated', '/../backup/', '189hWwGrK', 'DB\x20query\x20error', 'Files\x20has\x20been\x20deleted', '/login', 'query', 'DBPASSWORD', '/get_admin', 'express', 'path', 'get', 'Wrong\x20credentials', 'length']; _0x41b2 = function () { return _0x375853; }; return _0x41b2(); }